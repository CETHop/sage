#!/usr/bin/env bash

if [ "x$SAGE_LOCAL" = x ]; then
   echo "SAGE_LOCAL undefined ... exiting"
   echo "Maybe run 'sage -sh'?"
   exit 1
fi

# need to suppress confusing error messages and don't depend on system
# libraries, so easy_install is not available
tar xjf PyYAML-3.10.zip
python setup.py --without-libyaml install --prefix="$SAGE_LOCAL"
if [ $? -ne 0 ]; then
   echo "Error installing PyYAML."
   exit 1
fi

easy_install pyparsing-1.5.6.zip
if [ $? -ne 0 ]; then
   echo "Error installing pyparsing."
   exit 1
fi

# pybtex needs a patch, so easy_install is not available
cd src

# apply patch to make pybtex support bibtex standards better
patch -p0 < ../patches/pybtex-doc_tree.patch
if [ $? -ne 0 ]; then
   echo "Applying patch to pybtex failed."
   exit 1
fi

python setup.py install --prefix="$SAGE_LOCAL"
if [ $? -ne 0 ]; then
   echo "Error installing pybtex."
   exit 1
fi
