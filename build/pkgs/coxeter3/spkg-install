#!/usr/bin/env bash

#Patch
cd patches
cp directories.h directories.tmpl
sed -i "s|SAGE_LOCAL|$SAGE_LOCAL|g" directories.tmpl
cp directories.tmpl ../src/directories.h
cp makefile ../src/
cp sage.cpp sage.h ../src/

#Build
cd ../src
make all

#Install
cp coxeter "$SAGE_LOCAL/bin/"
if [ $UNAME = "Darwin" ]; then
    cp libcoxeter3.dylib "$SAGE_LOCAL/lib/"
else
    cp libcoxeter3.so "$SAGE_LOCAL/lib/"
fi

datadir="$SAGE_LOCAL/coxeter/"
mkdir -p $datadir
cp -r coxeter_matrices headers messages "$datadir"

includedir="$SAGE_LOCAL/include/coxeter/"
mkdir -p $includedir
cp -r *.h *.hpp $includedir
