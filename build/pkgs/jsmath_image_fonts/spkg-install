#!/usr/bin/env bash

if [ "$SAGE_LOCAL" = "" ]; then
   echo "SAGE_LOCAL undefined ... exiting";
   echo "Maybe run 'sage -sh'?"
   exit 1
fi

top_level=`pwd`
export top_level

if [ ! -d "$SAGE_ROOT/local/lib/python2.6/site-packages/sagenb" ]; then
    # user is using an old version of sage before the new notebook.
    install_dir="$SAGE_ROOT/local/notebook/javascript/jsmath"
else
    if [ ! -d "$SAGE_ROOT/local/lib/python2.6/site-packages/sagenb/data/jsmath" ]; then
	# pre-#7196 new notebook
	install_dir="$SAGE_ROOT/local/lib/python2.6/site-packages/sagenb/data/javascript/jsmath"
    else
	install_dir="$SAGE_ROOT/local/lib/python2.6/site-packages/sagenb/data/jsmath"
    fi
fi

export install_dir

mkdir -p $install_dir

if [ $? -ne 0 ]; then
   echo "Error making installation directory:"
   echo $install_dir
   exit 1
fi

echo "deleting old jsMath fonts"
rm -rf $install_dir/jsmath/fonts
if [ $? -ne 0 ]; then
   echo "Error deleting old jsMath fonts."
   exit 1
fi


echo "Installing jsMath Image Fonts to:"
echo $install_dir

cp -r src/* $install_dir

if [ $? -ne 0 ]; then
   echo "Error extracting jsMath Image Fonts."
   exit 1
fi

echo "Finished installing jsMath Image Fonts."
